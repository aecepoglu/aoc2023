numâ†'0'+â†•10
N9 â† {(Â«ğ•âŠ¢ğ•Â»)Ë˜(Â«ğ•âŠ¢ğ•Â»)ğ•©}

Solveâ†{ğ•Šraw:
 # extract all the numbers from the map (`values`)
 # also, mark on the map
 #   whether a spot is neighbour to a symbol (`bad`)
 #   which gears a spot is neighbour to (`gid`)
 #   which number a spot belongs to (`mid`)
 # `mid` paired up w/ `gid` gives which 2 numbers belong to a gear
 # `mid` masked over `bad` gives numbers are neighbours to a symbol
 
 Grpâ†(Â¬-ËœâŠ¢Ã—Â·+`Â»âŠ¸>)âˆ˜(9âŠ¸â‰¥)

 mapâ†(numâˆ¾".")âŠ raw
 # 0-9: digit, 10: space, 11: symbol

 bad â† âˆ¨Ë™âŠ¸N9 11=map
 val â† âˆ¾GrpâŠ¸âŠ”Â¨<Ë˜map
 pos â† âˆ¾((â†•âˆ˜â‰ )â‹ˆÂ¨Â¨Â¨âŠ¢) (GrpâŠ”â†•âˆ˜â‰ )Â¨<Ë˜map

 gid â† 0âŠ¸â‰ âŠ¸/Â¨ âˆ¾Â¨Ë™âŠ¸N9 +`âŠ¸Ã—âŒ¾â¥Š '*'=raw

 id  â† (â‰ Â¨/1+â†•âˆ˜â‰ )pos
 mid â† idâŒ¾((âˆ¾pos)âŠ¸âŠ‘) 0Â¨map

 bid â† â· 0âŠ¸<âŠ¸/ bad(/â—‹â¥Š)mid

 pairâ†â· (0â‰ 1âŠ¸âŠ‘Â¨)âŠ¸/âˆ¾ gid(â‹ˆÂ¨Â¨â—‹â¥Š)mid # âŸ¨gear_id, part_idâŸ© tuples
 pt2 â† +Â´Ã—Â´Â¨ (âŠ£+10Ã—âŠ¢)Â´âˆ˜âŒ½Â¨Â¨âŠâŸœvalÂ¨ 1-Ëœ (2=â‰ Â¨)âŠ¸/ ((âŠâŠ‘Â¨)âŠ”1âŠ¸âŠ‘Â¨) pair
 pt1 â† +Â´ (âŠ£+10Ã—âŠ¢)Â´âˆ˜âŒ½ Â¨(bid-1)âŠval
 
 pt1â€¿pt2
}

pt1â€¿pt2â† Solve >â€¢FLines "sample.txt"



